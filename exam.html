<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ุฃุณุฆูุฉ ุงูุชุญุงู</title>
    <link
      href="https://fonts.googleapis.com/css2?family=El+Messiri:wght@400..700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <script src="https://cdn.emailjs.com/dist/email.min.js"></script>

    <link rel="stylesheet" href="./css/exam.css" />
    <link rel="stylesheet" href="./css/nav.css" />
    <link rel="stylesheet" href="./css/all.min.css" />
  </head>
  <body>
    <div class="iframe-container">
      <header id="header" class="header">
        <ul>
          <a href="person.html" style="text-decoration: none">
            <div
              class="user"
              style="display: flex; align-items: center; font-size: 20px"
            >
              <i class="fa-solid fa-user" style="margin: 0 7px"></i>
              <p>ูุฑุญุจูุง <span id="user-name"></span>!</p>
            </div></a
          >
          <li><a href="test1.html" class="active">ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ</a></li>
          <li><a href="test1.html#sec">ูู ูุญู</a></li>
          <li><a href="test1.html#secindex">ุงูููุงุฏ ุงูุฏุฑุงุณูุฉ</a></li>
          <li><a href="test1.html#footer"> ุชูุงุตู ูุนูุง</a></li>
        </ul>
        <a href="#" class="logo">NEMMY</a>
      </header>

      <div class="containerq">
        <h2>ุฃุณุฆูุฉ ุงูุชุญุงู ุนูู ุงูุฏุฑุณ ุงูุฃูู</h2>
        <div id="progress" style="margin-top: 20px"></div>
        <div class="question">
          <p>ูุง ูู ุงูุญุฏุซ ุงูุฃุจุฑุฒ ุงูุฐู ุจุฏุฃ ุจู "ุงูุนุตุฑ ุงูุนุชูู"ุ</p>
          <label
            ><input type="radio" name="q1" value="incorrect" /> ุชุฃุณูุณ ุงููุฑู
            ุงูุฃูุจุฑ</label
          ><br />
          <label
            ><input type="radio" name="q1" value="correct" /> ุชูุญูุฏ ุงูููู ูุนุฑูุฑ
            (ูููุง) ูููููุชู ุงูุดูุงู ูุงูุฌููุจ</label
          ><br />
          <label
            ><input type="radio" name="q1" value="incorrect" /> ุจูุงุก ูุฏููุฉ "ูู
            ููุฑ"</label
          ><br />
          <label
            ><input type="radio" name="q1" value="incorrect" /> ุจูุงุก ุฃูู ูุนุจุฏ ูู
            ุงูุชุงุฑูุฎ</label
          >
        </div>
        <hr />

        <div class="question">
          <p>
            ูุง ุงูุฐู ุงูุชู ุจู ุงููููู ูู "ุงูุนุตุฑ ุงูุนุชูู" ูุถูุงู ุงูุงุณุชูุฑุงุฑ ูุงูุฃููุ
          </p>
          <label
            ><input type="radio" name="q2" value="incorrect" /> ุจูุงุก
            ุงูุฌุณูุฑ</label
          ><br />
          <label
            ><input type="radio" name="q2" value="correct" /> ุจูุงุก ุงูุญุตูู ูุชุฃููู
            ุงูุญุฏูุฏ</label
          ><br />
          <label
            ><input type="radio" name="q2" value="incorrect" /> ุชุทููุฑ ุงูุฃุณุทูู
            ุงูุจุญุฑู</label
          ><br />
          <label
            ><input type="radio" name="q2" value="incorrect" /> ุชุญุณูู ุงูุทุฑู
            ุงูุตุญุฑุงููุฉ</label
          >
        </div>
        <hr />

        <div class="question">
          <p>ูุง ูู ุงูุชุบูุฑ ุงูุฐู ุทุฑุฃ ุนูู ุงูููุงุจุฑ ุงูููููุฉ ูู ุงูุนุตุฑ ุงูุนุชููุ</p>
          <label
            ><input type="radio" name="q3" value="incorrect" /> ุชู ุฏูู ุงููููู ูู
            ุฃูุฑุงูุงุช</label
          ><br />
          <label
            ><input type="radio" name="q3" value="incorrect" /> ุชู ุงุณุชุฎุฏุงู ุงูุฐูุจ
            ูู ุจูุงุก ุงูููุงุจุฑ</label
          ><br />
          <label
            ><input type="radio" name="q3" value="correct" /> ุชุญููุช ุงูููุงุจุฑ ูู
            ุญูุฑุฉ ูู ุงูุฃุฑุถ ุฅูู ุญุฌุฑุฉ ุฏูู ูู ุงูุญุฌุฑ ุงูุฌูุฑู</label
          ><br />
          <label
            ><input type="radio" name="q3" value="incorrect" /> ุชู ุจูุงุก ูุนุงุจุฏ
            ุนูู ุงูููุงุจุฑ</label
          >
        </div>
        <hr />

        <div class="question">
          <p>
            ูุง ูู ุฃูู ุงูุฃูุดุทุฉ ุงูุงูุชุตุงุฏูุฉ ุงูุชู ุงูุชู ุจูุง ุงููููู ูู ุงูุนุตุฑ ุงูุนุชููุ
          </p>
          <label
            ><input type="radio" name="q4" value="correct" /> ุชุฃููู ุงูุชุฌุงุฑุฉ
            ูุงูุทุฑู ุงูุตุญุฑุงููุฉ ูุงุณุชุบูุงู ุงูููุงุฌู</label
          ><br />
          <label
            ><input type="radio" name="q4" value="incorrect" /> ุงูุฒุฑุงุนุฉ
            ููุท</label
          ><br />
          <label
            ><input type="radio" name="q4" value="incorrect" /> ุชุฑุจูุฉ
            ุงูููุงุดู</label
          ><br />
          <label
            ><input type="radio" name="q4" value="incorrect" /> ุจูุงุก
            ุงูุณูู</label
          >
        </div>
        <hr />

        <div class="question">
          <p>
            ูู ูู ุงูููู ุงูุฐู ุฃุณุณ ุงูุฃุณุฑุฉ ุงูุฑุงุจุนุฉ ููุงู ุจุฅุฑุณุงู ุฃุณุทูู ุจุญุฑู ูุฌูุจ
            ุงูุฃุฎุดุงุจ ูู ููููููุงุ
          </p>
          <label
            ><input type="radio" name="q5" value="incorrect" /> ุงูููู
            ุฎููู</label
          ><br />
          <label
            ><input type="radio" name="q5" value="incorrect" /> ุงูููู
            ุฎูุฑุน</label
          ><br />
          <label
            ><input type="radio" name="q5" value="correct" /> ุงูููู ุณููุฑู</label
          ><br />
          <label
            ><input type="radio" name="q5" value="incorrect" /> ุงูููู
            ุฒูุณุฑ</label
          >
        </div>
        <hr />

        <button id="submitBtn" onclick="calculateScore()">ุฅุธูุงุฑ ุงููุชูุฌุฉ</button>

        <div id="result" style="height: 20px"></div>
        <button id="backBtn" style="margin-top: 10px" onclick="goBack()">
          ุฑุฌูุน
        </button>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>

    <script>
      let parentEmail = localStorage.getItem("parent-id");
      let studentName = localStorage.getItem("username");
      document.addEventListener("DOMContentLoaded", function () {
        emailjs.init("SzIprg_7vq5mh7tev"); // ุชููุฆุฉ emailjs
        let username = localStorage.getItem("username");
        document.getElementById("user-name").textContent = username
          ? username
          : "ุฒุงุฆุฑ";
      });

      window.onload = function () {
        alert(
          "ุชุญุฐูุฑ: ุฅุฐุง ุบุงุฏุฑุช ุงูุชุจููุจ ุฃู ูุชุญุช ุตูุญุฉ ุฃุฎุฑูุ ุณูุชู ุฅููุงุก ุงูุงูุชุญุงู!"
        );
      };

      function goBack() {
        window.history.back();
      }

      document.addEventListener("visibilitychange", function () {
        if (document.hidden) {
          window.location.href = "./test1.html"; // ุงุณุชุจุฏููุง ุจุงูุตูุญุฉ ุงูููุงุณุจุฉ
        }
      });
      
      let lessonCount = parseInt(localStorage.getItem('lessonCount')) || 0;

function calculateScore() {
    lessonCount++;
    localStorage.setItem('lessonCount', lessonCount);
        let score = 0;
        const questions = ["q1", "q2", "q3", "q4", "q5"];

        // ุงูุชุญูู ูู ุฅุฌุงุจุฉ ุฌููุน ุงูุฃุณุฆูุฉ
        for (let q of questions) {
          if (!document.querySelector(`input[name="${q}"]:checked`)) {
            alert("ูุฑุฌู ุงูุฅุฌุงุจุฉ ุนูู ุฌููุน ุงูุฃุณุฆูุฉ ูุจู ุนุฑุถ ุงููุชูุฌุฉ.");
            return;
          }
        }

        // ุญุณุงุจ ุงูุฏุฑุฌุงุช
        questions.forEach((q) => {
          const selectedAnswer = document.querySelector(
            `input[name="${q}"]:checked`
          );
          if (selectedAnswer.value === "correct") {
            score++;
          }
        });

        // ุนุฑุถ ุงููุชูุฌุฉ
        document.getElementById("result").innerText = `ุงููุชูุฌุฉ: ${score} ูู 5`;

        // ุชุนุทูู ุฌููุน ุฃุฒุฑุงุฑ ุงูุงุฎุชูุงุฑ ุจุนุฏ ุธููุฑ ุงููุชูุฌุฉ
        questions.forEach((q) => {
          document.querySelectorAll(`input[name="${q}"]`).forEach((input) => {
            input.disabled = true;
          });
        });

        // ุชุนุทูู ุฒุฑ ุฅุธูุงุฑ ุงููุชูุฌุฉ
        document.getElementById("submitBtn").disabled = true;

        // ุฅุฑุณุงู ุงูุฅูููู ุชููุงุฆููุง ุจุนุฏ ุญุณุงุจ ุงููุชูุฌุฉ
        sendEmail(score);
        // ุฅูุดุงุก ุฒุฑ ุฌุฏูุฏ ุจูุงุกู ุนูู ุงููุชูุฌุฉ
        const newButton = document.createElement('button');
          newButton.classList.add('dynamic-button');
          
          if (score >= 3) {
              newButton.textContent = 'ููุช ุงูุงูุนุงุจ';
              newButton.style.backgroundColor = '#4CAF50'; // ููู ุฃุฎุถุฑ
              newButton.onclick = function() {
                  window.location.href = 'games.html'; // ุงุณุชุจุฏู ุจุงูุฑุงุจุท ุงููุนูู
              };
          } else {
              newButton.textContent = 'ุฅุนุงุฏุฉ ูุฑุงุฌุนุฉ ุงูุฏุฑุณ';
              newButton.style.backgroundColor = 'red'; // ููู ุฃุญูุฑ
              newButton.onclick = function() {
                  window.location.href = 'test1.html#secindex'; // ุงุณุชุจุฏู ุจุงูุฑุงุจุท ุงููุนูู
              };
          }
      
          // ุฅุถุงูุฉ ุงูุชูุณููุงุช ููุฃุฒุฑุงุฑ
          newButton.style.color = 'white';
          newButton.style.padding = '10px';
          newButton.style.borderRadius = '5px';
          newButton.style.marginTop = '10px';
          newButton.style.cursor = 'pointer';
      
          // ุฅุฏุฑุงุฌ ุงูุฒุฑ ูุจู ุฒุฑ ุงูุฑุฌูุน
          const container = document.querySelector('.containerq');
          const backButton = document.querySelector('#submitBtn[onclick="goBack()"]');
          container.insertBefore(newButton, backButton);

      }
      // function sendEmail(score) {
      //   if (parentEmail && studentName) {
      //     var emailParams = {
      //       to_email: parentEmail, // ุฅุฑุณุงู ุงูุฅูููู ูููู ุงูุฃูุฑ
      //       student_name: "ููุฏ ุญุตู"+studentName+" ุนูู ุฏุฑุฌุฉ "+score+ " ูู 5" +"ูู ุงูุงุฎุชุจุงุฑ",
      //     };

      //     emailjs
      //       .send("service_esmgsr2", "template_g0hglkz", emailParams)
      //       .then(function () {
      //         alert("๐ง ุชู ุฅุฑุณุงู ุงูุฅูููู ุจูุฌุงุญ ุฅูู ููู ุงูุฃูุฑ.");
      //       })
      //       .catch(function () {
      //         alert("โ๏ธ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฅุฑุณุงู ุงูุฅูููู.");
      //       });
      //   } else {
      //     alert("โ๏ธ ุชุฃูุฏ ูู ุชุณุฌูู ุจูุงูุงุช ุงูุทุงูุจ ูููู ุงูุฃูุฑ ูุจู ุงูุฅุฑุณุงู.");
      //   }
      // }
   
      /////////////
      function updateProgress(subjectId, completedLessons) {
        const totalLessons = countLessons(subjectId);
        const progressPercentage = (completedLessons / totalLessons) * 100;
        document.getElementById(
          "progress"
        ).innerText = `ุงูุชูุฏู: ${progressPercentage.toFixed(2)}%`;
      }

      // ูุซุงู ุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ
      document
        .getElementById("submitBtn")
        .addEventListener("click", function () {
          const completedLessons = 3; // ุนุฏุฏ ุงูุฏุฑูุณ ุงูููุชููุฉุ ููููู ุชุบููุฑู ุจูุงุกู ุนูู ููุทูู
          updateProgress("sci", completedLessons);
        });

    </script>
  </body>
</html>
